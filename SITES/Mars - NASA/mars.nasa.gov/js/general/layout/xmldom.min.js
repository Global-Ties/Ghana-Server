var whitespace="\n\r\t ",quotes="\"'";function convertEscapes(e){for(t=-1;e.indexOf("&lt;",t+1)>-1;){var t=e.indexOf("&lt;",t+1),r=e.substr(0,t);r+="<",e=r+=e.substr(t+4,e.length)}for(t=-1;e.indexOf("&gt;",t+1)>-1;){t=e.indexOf("&gt;",t+1),r=e.substr(0,t);r+=">",e=r+=e.substr(t+4,e.length)}for(t=-1;e.indexOf("&amp;",t+1)>-1;){t=e.indexOf("&amp;",t+1),r=e.substr(0,t);r+="&",e=r+=e.substr(t+5,e.length)}return e}function convertToEscapes(e){for(var t=-1;e.indexOf("&",t+1)>-1;){t=e.indexOf("&",t+1);var r=e.substr(0,t);r+="&amp;",e=r+=e.substr(t+1,e.length)}for(t=-1;e.indexOf("<",t+1)>-1;){t=e.indexOf("<",t+1),r=e.substr(0,t);r+="&lt;",e=r+=e.substr(t+1,e.length)}for(t=-1;e.indexOf(">",t+1)>-1;){t=e.indexOf(">",t+1),r=e.substr(0,t);r+="&gt;",e=r+=e.substr(t+1,e.length)}return e}function _displayElement(e,t){if(null!=e&&"ELEMENT"==e.nodeType){var r=e.tagName,n="";n="<"+r;for(var i=e.getAttributeNames(),s=0;s<i.length;s++){var o=i[s];n=(n=n+" "+o+"=")+'"'+e.getAttribute(o)+'"'}if(t+=n+=">",null!=e.children){var h=e.children;for(s=0;s<h.length;s++){var d=h[s];if("COMMENT"==d.nodeType)t=t+"\x3c!--"+d.content+"--\x3e";else if("TEXT"==d.nodeType){trim(d.content,!0,!0);t+=d.content}else if("CDATA"==d.nodeType){t=t+"<![CDATA["+trim(d.content,!0,!0)+"]]>"}else t=_displayElement(d,t)}}return t=t+"</"+r+">"}}function firstWhiteChar(e,t){if(isEmpty(e))return-1;for(;t<e.length;){if(-1!=whitespace.indexOf(e.charAt(t)))return t;t++}return e.length}function isEmpty(e){return null==e||0==e.length}function trim(e,t,r){if(isEmpty(e))return"";null==t&&(t=!0),null==r&&(r=!0);var n=0,i=0,s=0,o=0;if(1==t)for(;s<e.length&&-1!=whitespace.indexOf(e.charAt(s++));)n++;if(1==r)for(o=e.length-1;o>=n&&-1!=whitespace.indexOf(e.charAt(o--));)i++;return e.substring(n,e.length-i)}function XMLDoc(e,t){if(this.topNode=null,this.errFn=t,this.createXMLNode=_XMLDoc_createXMLNode,this.error=_XMLDoc_error,this.getUnderlyingXMLText=_XMLDoc_getUnderlyingXMLText,this.handleNode=_XMLDoc_handleNode,this.hasErrors=!1,this.insertNodeAfter=_XMLDoc_insertNodeAfter,this.insertNodeInto=_XMLDoc_insertNodeInto,this.loadXML=_XMLDoc_loadXML,this.parse=_XMLDoc_parse,this.parseAttribute=_XMLDoc_parseAttribute,this.parseDTD=_XMLDoc_parseDTD,this.parsePI=_XMLDoc_parsePI,this.parseTag=_XMLDoc_parseTag,this.removeNodeFromTree=_XMLDoc_removeNodeFromTree,this.replaceNodeContents=_XMLDoc_replaceNodeContents,this.selectNode=_XMLDoc_selectNode,this.selectNodeText=_XMLDoc_selectNodeText,this.source=e,this.parse())return null==this.topNode||this.error("expected close "+this.topNode.tagName)}function _XMLDoc_createXMLNode(e){return new XMLDoc(e,this.errFn).docNode}function _XMLDoc_error(e){return this.hasErrors=!0,this.errFn?this.errFn("ERROR: "+e):this.onerror&&this.onerror("ERROR: "+e),0}function _XMLDoc_getTagNameParams(e,t){var r,n=-1,i=e.indexOf("["),s=[];return i>=0&&((r=e.indexOf("]"))>=0?n=e.substr(i+1,r-i-1):t.error("expected ] near "+e),e=e.substr(0,i),isNaN(n)&&"*"!=n?((s=(s=n.substr(1,n.length-1)).split("="))[1]&&(i=s[1].indexOf('"'),s[1]=s[1].substr(i+1,s[1].length-1),(r=s[1].indexOf('"'))>=0?s[1]=s[1].substr(0,r):t.error('expected " near '+e)),n=-1):"*"==n&&(n=-1)),[e,n,s[0],s[1]]}function _XMLDoc_getUnderlyingXMLText(){var e="";if(e+='<?xml version="1.0"?>',null!=this.docNode)return e=_displayElement(this.docNode,e)}function _XMLDoc_handleNode(e){if("COMMENT"==e.nodeType&&null!=this.topNode)return this.topNode.addElement(e);if("TEXT"==e.nodeType||"CDATA"==e.nodeType)return null==this.topNode?""==trim(e.content,!0,!1)||this.error("expected document node, found: "+e):this.topNode.addElement(e);if("OPEN"==e.nodeType||"SINGLE"==e.nodeType){var t=!1;return null==this.topNode?(this.docNode=e,e.parent=null,t=!0):t=this.topNode.addElement(e),t&&"SINGLE"!=e.nodeType&&(this.topNode=e),e.nodeType="ELEMENT",t}if("CLOSE"==e.nodeType){if(null==this.topNode)return this.error("close tag without open: "+e.toString());if(e.tagName!=this.topNode.tagName)return this.error("expected closing "+this.topNode.tagName+", found closing "+e.tagName);this.topNode=this.topNode.getParent()}return!0}function _XMLDoc_insertNodeAfter(e,t){var r=this.getUnderlyingXMLText(),n=e.getUnderlyingXMLText(),i=r.indexOf(n)+n.length,s=r.substr(0,i);return s+=t.getUnderlyingXMLText(),new XMLDoc(s+=r.substr(i),this.errFn)}function _XMLDoc_insertNodeInto(e,t){var r=this.getUnderlyingXMLText(),n=e.getUnderlyingXMLText(),i=n.indexOf(">")+1,s=r.indexOf(n)+i,o=r.substr(0,s);return o+=t.getUnderlyingXMLText(),new XMLDoc(o+=r.substr(s),this.errFn)}function _XMLDoc_loadXML(e){return this.topNode=null,this.hasErrors=!1,this.source=e,this.parse()}function _XMLDoc_parse(){var e=0;for(err=!1;!err;){var t,r,n="",i=this.source.indexOf("<",e);if(-1==i)break;t=i;var s=this.source.substring(e,t);if(0!=s.length&&(err=!this.handleNode(new XMLNode("TEXT",this,s))),i!=this.source.indexOf("<?",e))if(i!=this.source.indexOf("<!DOCTYPE",e)){if(i==this.source.indexOf("\x3c!--",e)&&(4,n="--"),i==this.source.indexOf("<![CDATA[",e)&&(9,n="]]"),-1==(i=this.source.indexOf(n+">",i)))return this.error("expected closing tag sequence: "+n+">");r=i+n.length,s=this.source.substring(t+1,r);var o=this.parseTag(s);o&&(err=!this.handleNode(o)),e=r+1}else 0==(e=this.parseDTD(this.source,i+9))&&(err=!0);else 0==(e=this.parsePI(this.source,e+2))&&(err=!0)}return!err}function _XMLDoc_parseAttribute(e,t,r){for(;t<e.length&&-1!=whitespace.indexOf(e.charAt(t));)t++;if(t>=e.length)return t;for(var n=t;t<e.length&&"="!=e.charAt(t);)t++;var i="attributes must have values";if(t>=e.length)return this.error(i);for(var s=trim(e.substring(n,t++),!1,!0);t<e.length&&-1!=whitespace.indexOf(e.charAt(t));)t++;if(t>=e.length)return this.error(i);i="attribute values must be in quotes";var o=e.charAt(t++);if(-1==quotes.indexOf(o))return this.error(i);for(n=t;t<e.length&&e.charAt(t)!=o;)t++;return t>=e.length?this.error(i):r.addAttribute(s,trim(e.substring(n,t++),!1,!0))?t:0}function _XMLDoc_parseDTD(e,t){var r=e.indexOf(">",t);if(-1==r)return this.error("error in DTD: expected '>'");var n="",i=e.indexOf("[",t);for(-1!=i&&i<r&&(n="]");;){var s=e.indexOf(n+">",t);if(-1==s)return this.error("expected closing tag sequence: "+n+">");if(t=s+n.length+1,"]]>"!=e.substring(s-1,s+2))break}return t}function _XMLDoc_parsePI(e,t){return e.indexOf("?>",t)+2}function _XMLDoc_parseTag(e){if(0==e.indexOf("!--"))return new XMLNode("COMMENT",this,e.substring(3,e.length-2));if(0==e.indexOf("![CDATA["))return new XMLNode("CDATA",this,e.substring(8,e.length-2));var t=new XMLNode;if(t.doc=this,"/"==e.charAt(0)?(t.nodeType="CLOSE",e=e.substring(1)):t.nodeType="OPEN","/"==e.charAt(e.length-1)){if("CLOSE"==t.nodeType)return this.error("singleton close tag");t.nodeType="SINGLE",e=e.substring(0,e.length-1)}if("CLOSE"!=t.nodeType&&(t.attributes=new Array),"OPEN"==t.nodeType&&(t.children=new Array),0==(e=trim(e,!0,!0)).length)return this.error("empty tag");var r=firstWhiteChar(e,0);if(-1==r)return t.tagName=e,t;t.tagName=e.substring(0,r);for(var n=r;n<e.length;)if(n=this.parseAttribute(e,n,t),0==this.pos)return null;return t}function _XMLDoc_removeNodeFromTree(e){var t=this.getUnderlyingXMLText(),r=e.getUnderlyingXMLText(),n=t.indexOf(r),i=t.substr(0,n);return new XMLDoc(i+=t.substr(n+r.length),this.errFn)}function _XMLDoc_replaceNodeContents(e,t){var r=this.createXMLNode("<X>"+t+"</X>");return e.children=r.children,this}function _XMLDoc_selectNode(e){var t,r,n,i,s,o,h;if(e=trim(e,!0,!0),t=r=this.source?this.docNode:this,!e)return r;if(0==e.indexOf("/")&&(e=e.substr(1)),(n=(e=e.replace(n,"")).split("/")[0])&&(0==e.indexOf("/")&&(e=e.substr(1)),e=e.replace(n,""),n=(i=_XMLDoc_getTagNameParams(n,this))[0],s=i[1],o=i[2],h=i[3],(r="*"==n?r.getElements():r.getElements(n)).length))if(s<0){t=r;for(var d=0;d<t.length;){if((!o||t[d].getAttribute(o)==h)&&(r=t[d].selectNode(e)))return r;d++}}else if(s<r.length&&(r=r[s].selectNode(e)))return r}function _XMLDoc_selectNodeText(e){var t=this.selectNode(e);return null!=t?t.getText():null}function XMLNode(e,t,r){this.content="TEXT"==e||"CDATA"==e||"COMMENT"==e?r:null,this.attributes=null,this.children=null,this.doc=t,this.nodeType=e,this.parent="",this.tagName="",this.addAttribute=_XMLNode_addAttribute,this.addElement=_XMLNode_addElement,this.getAttribute=_XMLNode_getAttribute,this.getAttributeNames=_XMLNode_getAttributeNames,this.getElementById=_XMLNode_getElementById,this.getElements=_XMLNode_getElements,this.getText=_XMLNode_getText,this.getParent=_XMLNode_getParent,this.getUnderlyingXMLText=_XMLNode_getUnderlyingXMLText,this.removeAttribute=_XMLNode_removeAttribute,this.selectNode=_XMLDoc_selectNode,this.selectNodeText=_XMLDoc_selectNodeText,this.toString=_XMLNode_toString}function _XMLNode_addAttribute(e,t){return this.attributes["_"+e]=t,!0}function _XMLNode_addElement(e){return e.parent=this,this.children[this.children.length]=e,!0}function _XMLNode_getAttribute(e){return null==this.attributes?null:this.attributes["_"+e]}function _XMLNode_getAttributeNames(){if(null==this.attributes)return new Array;var e=new Array;for(var t in this.attributes)e[e.length]=t.substring(1);return e}function _XMLNode_getElementById(e){var t;if(this.getAttribute("id")==e)return this;for(var r=this.getElements(),n=0;n<r.length;){if(null!=(t=r[n].getElementById(e)))break;n++}return t}function _XMLNode_getElements(e){if(null==this.children)return new Array;for(var t=new Array,r=0;r<this.children.length;r++)"ELEMENT"!=this.children[r].nodeType||null!=e&&this.children[r].tagName!=e||(t[t.length]=this.children[r]);return t}function _XMLNode_getText(){if("ELEMENT"==this.nodeType){if(null==this.children)return null;for(var e="",t=0;t<this.children.length;t++){var r=this.children[t].getText();e+=null==r?"":r}return e}return"TEXT"==this.nodeType?convertEscapes(this.content):this.content}function _XMLNode_getParent(){return this.parent}function _XMLNode_getUnderlyingXMLText(){var e="";return e=_displayElement(this,e)}function _XMLNode_removeAttribute(e){if(null==e)return this.doc.error("You must pass an attribute name into the removeAttribute function");var t=this.getAttributeNames(),r=t.length,n=new Array;for(intLoop=0;intLoop<r;intLoop++)n[intLoop]=this.getAttribute(t[intLoop]);for(this.attributes=new Array,intLoop=0;intLoop<r;intLoop++)t[intLoop]!=e&&this.addAttribute(t[intLoop],n[intLoop]);return!0}function _XMLNode_toString(){return this.nodeType+":"+("TEXT"==this.nodeType||"CDATA"==this.nodeType||"COMMENT"==this.nodeType?this.content:this.tagName)}