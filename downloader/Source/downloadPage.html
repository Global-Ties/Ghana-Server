<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">

<head>
  <h1 class="w3-margin w3-jumbo">Schoolhouse Ghana Teacher Portal</h1>
  <link rel="stylesheet" href="/css" type="text/css">
</head>

<body>
  <div id="page_container">
    <div id="form_container">
      <h1 id="title">Add Link to Download</h1>
      <form>
        <div id="input_display">
          <div id="name">
            <p >Page Title:<input type="text" id="page_title" placeholder="Page Title" ></p>
          </div>
          <div id="date">
              <p>Due Date:<input type="date" id="due_date" name="page_due_date" /></p>
            </div>
        </div>
      
        <div id="url">
          <p id="url-container">URL:<input type="text" id="page_URL" placeholder="URL" /></p>
        </div>
        <div class="checkboxes">
          <p>Grade:</p>
          <label>
            <input type="checkbox" name="Grade" value="Grade_1">First Grade
          </label>
          <label>
            <input type="checkbox" name="Grade" value="Grade_2">Second Grade
          </label>
          <label>
            <input type="checkbox" name="Grade" value="Grade_3">Third Grade
          </label>
          <label>
            <input type="checkbox" name="Grade" value="Grade_4">Fourth Grade
          </label>
          <label>
            <input type="checkbox" name="Grade" value="Grade_5">Fifth Grade
          </label>
          <label>
            <input type="checkbox" name="Grade" value="Grade_6">Sixth Grade
          </label>
        </div>
        <div class="checkboxes">
          <p>Subject:</p>
          <label>
            <input type="checkbox" name="subject" value="math">Math
          </label>
          <label>
            <input type="checkbox" name="subject" value="reading">Reading
          </label>
          <label>
            <input type="checkbox" name="subject" value="science">Science
          </label>
        </div>
        <div>
          <p>Page Description:</p>
          <input type="text" id="page_description" placeholder="Page Description"/>
        </div>
      </form>
      <button class="button" onclick="download()" id="download_btn">Add to Queue</button>
    </div>
    <div id="download_progress_container">
      <h1 id="download_progress_title">Download Queue</h1>
      <div id="download_progress_contents">

        <div class="queue_item">
          <div class="queue_item_details">
            <h2>title</h2>
            <a href="api/nav/https:/google.com">URL</a>
          </div>
          <div class="queue_item_status" id="">
            <div>
              <p>queued time</p>
            </div>
            <div>
              <p>done time</p>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</body>

<script src="/axios"></script>
<script>

  function download() {
    var title = document.getElementById("page_title").value;
    var url = document.getElementById("page_URL").value;
    var dueDate = document.getElementById("due_date").value;
    var description = document.getElementById("page_description").value;


    var grades = [];
    document.getElementsByName("Grade").forEach(function(elem) {
      if ( elem.checked ) {
        grades.push(elem.value);
      }
    });

    var subjects = [];
    document.getElementsByName("subject").forEach(function(elem) {
      if ( elem.checked ) {
        subjects.push(elem.value);
      }
    });

    /** CHANGE NAME TO TEACHER NAME WHEN ACCOUNTS ARE SET UP**/
    var downloadRequest = {};
    downloadRequest[title] = {
        name: title,
        url: url,
        grades: grades,
        subjects: subjects,
        dueDate: dueDate,
        description: description,
        time: new Date()
    }

    axios.post('/api/download', downloadRequest).then(function(res) {
        console.log("POST RESPONSE:", res);
    }).catch(function(err) {
        console.err(err);
    })
    
  }

  setInterval(function() {
    console.log("hi")
    axios.get('/api/update').then(function(res) {
      update = ""
      for (var key in res.data[0]) {
        console.log("complete")
        update += createDownloadProgressModule(res.data[0][key], new Date());
      }
      for (var key in res.data[1]) {
        console.log("curr")
        update += createDownloadProgressModule(res.data[1][key], "Downloading");
      }
      for (var key in res.data[2]) {
        console.log("queue")
        update += createDownloadProgressModule(res.data[2][key], "-----");
      }
      document.getElementById("download_progress_contents").innerHTML = update;
    })
  }, 1500)

  function createDownloadProgressModule(data, status) {
    result = "<div class=\"queue_item\">" +
      "<div class=\"queue_item_details\">" +
        "<h2>" + data.name + "</h2>" +
        "<a href=\"api/nav/" + data.url + "\">" + data.url + "</a>" +
      "</div>" +
      "<div class=\"queue_item_status\">" +
        "<div>" +
          "<p>" + status + "</p>" +
        "</div>" +
      "</div>" +
    "</div>"
    return result;
  }
</script>

</html>
